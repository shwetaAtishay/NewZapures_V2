@using NewZapures_V2.Models
@{
    ViewBag.Title = "College Facility";
    Layout = null;
    List<CustomMaster> CourseList = new List<CustomMaster>();
    if (ViewBag.CourseList != null)
    {
        CourseList = (List<CustomMaster>)ViewBag.CourseList;
    }

    TrusteeBO.CollageFacility CollageFacilityMster = new TrusteeBO.CollageFacility();
    if (ViewBag.CollageFacilityMster != null)
    {
        CollageFacilityMster = (TrusteeBO.CollageFacility)ViewBag.CollageFacilityMster;
    }
    List<CustomMaster> Facilites = new List<CustomMaster>();
    if (ViewBag.Facilites != null)
    {
        Facilites = (List<CustomMaster>)ViewBag.Facilites;
    }
    List<AddCourseBO> GuidDetail = new List<AddCourseBO>();
    if (ViewBag.GuidDetail != null)
    {
        GuidDetail = (List<AddCourseBO>)ViewBag.GuidDetail;
    }


    List<NewZapures_V2.Models.AddCourseBO> FacilitesDetails = ViewBag.FeeDetails as List<NewZapures_V2.Models.AddCourseBO>;
}
@section styles {

    <link href="~/plugins/dropify/css/dropify.min.css" rel="stylesheet">
    <link href="~/Content/NocCustomCss/StyleNoc.css" rel="stylesheet" />
}
<style type="text/css">
    .dropify-wrapper {
        display: block;
        position: relative;
        cursor: pointer;
        overflow: hidden;
        width: 100%;
        max-width: 100%;
        height: 138px;
        padding: 5px 10px;
        font-size: 14px;
        line-height: 22px;
        color: #777;
        background-color: #FFF;
        background-image: none;
        text-align: center;
        border: 2px solid #E5E5E5;
        -webkit-transition: border-color .15s linear;
        transition: border-color .15s linear;
    }
    /*
    .table thead {
        background-color: #646d91 !important;
    }

    .table th {
        color: #ffffff !important;
    }*/

    .fsc {
        background: #6441A5;
        background: -webkit-linear-gradient(to left, #2a0845, #6441A5);
        background: linear-gradient(to left, #506ee4, #5b3a96);
        border-radius: 12px;
    }

        .fsc h4 {
            color: white !important;
        }

    .fsi {
        background: #6441A5;
        background: -webkit-linear-gradient(to right, #2a0845, #6441A5);
        background: linear-gradient(to right, #506ee4, #5b3a96);
        border-radius: 12px;
    }

        .fsi h4 {
            color: white !important;
        }

    .fop {
        background: #B993D6; /* fallback for old browsers */
        background: -webkit-linear-gradient(to left, #8CA6DB, #B993D6); /* Chrome 10-25, Safari 5.1-6 */
        background: linear-gradient(to left, #8CA6DB, #B993D6); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
        border-radius: 12px;
    }

        .fop h4 {
            color: white !important;
        }
</style>
<div class="row d-none">
    <div class="col-sm-12">
        <div class="page-title-box">
            @*<div class="float-right">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item">NOC</li>
                        <li class="breadcrumb-item">Master</li>
                        <li class="breadcrumb-item active">Collage Facility</li>
                    </ol>
                </div>*@
            <h4 class="page-title">@ViewBag.Title</h4>
        </div><!--end page-title-box-->
    </div><!--end col-->
</div>

<div class="card noc-layouts m-0">
    <div class="card-header title-heading p-0">
        <h4 class="m-0 title-heading float-left">@ViewBag.Title</h4>
        @*<div class="form-group" style="text-align:right">
                <a href="@Url.Action("EditApplication","Trustee",new {Guid=SessionModel.ApplicantGuid })" style="font-size: 15px ; color: white;  font-family: 'Ubuntu', sans-serif;" class="btn btn-gradient-successnav-link btn btn-success">Back</a>
            </div>*@
    </div>

    @{
        foreach (var item in GuidDetail)
        {
            <input type="hidden" id="TrustId" value="@item.TrustInfoId" />
            <input type="hidden" id="clgId" value="@item.iCollegeId" />
            <input type="hidden" id="DeptId" value="@item.iFK_DeptId" />
        }
    }
    <input type="hidden" id="clgId" value="@TempData["clgId"]" />
    <div class="card-body row" id="refer">
        <div class="col-12">

            @*@using (Html.BeginForm("CollageFacilitys", "Trustee", FormMethod.Post, new { id = "CollageFacilityform", enctype = "multipart/form-data" }))
                {
                <div class="row">
                    <div class="col-lg-4">
                        <div class="">
                            <label for="example-text-input" class="col-sm-12" style="margin-left:-10px">Select Trust</label>
                            <div>
                                <select class="form-control" name="TrustId" id="TrustId">
                                    <option value="0">Select Trust</option>
                                    @{
                                        foreach (var item in TrustList)
                                        {
                                            if(ViewData["TrustId"].ToString() == item.Id.ToString())
                                            {
                                               <option value="@item.Id" selected>@item.text</option>
                                            }
                                            else
                                            {
                                              <option value="@item.Id">@item.text</option>
                                            }
                                        }
                                    }
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="">
                            <label for="example-text-input" class="col-sm-12" style="margin-left:-10px">College</label>
                            <div>
                                <select class="form-control" id="CollageId" name="CollageId">
                                    <option value="">Select Collage</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="form-group col-lg-4">
                        <button class="btn btn-primary" id="btnsearch" style="margin-top:28PX">Submit</button>
                    </div>
                </div>
                        }*@


            <div class="row">
                <div class="col-lg-4">
                    <div class="form-group">
                        <lable class="noc-form-label"><strong>Course</strong></lable>
                        <span style="color:red;">*</span>
                        <select class="form-control noc-input-text" id="Course" name="Course" required>
                            <option value="0">Select Course</option>
                            @{
                                foreach (var item in CourseList)
                                {
                                    <option value="@item.Id">@item.text</option>
                                }
                            }
                        </select>
                    </div>
                    <div>
                        <label for="error" class="col-sm-12" id="errorCourse" style="display:none;"></label>
                    </div>
                </div>
                <div class="col-lg-4 form-group">
                    <div class="form-group">
                        <lable class="noc-form-label"><strong>Select Facilities</strong></lable>
                        <span style="color:red;">*</span>
                        <select class="form-control noc-input-text" id="Facilites" name="Facilites" required>
                            <option value="0">Select Facilites</option>
                            @{
                                foreach (var item in Facilites)
                                {
                                    <option value="@item.Id">@item.text</option>
                                }
                            }
                        </select>
                    </div>
                    <div>
                        <label for="error" class="col-sm-12" id="errorFacilites" style="display:none;"></label>
                    </div>
                </div>
                <div class="col-lg-4 form-group">
                    <label for="noc-text-input " class="noc-form-label" style="">Choose File<span style="color:red;">*</span></label>
                    <div>
                        <input type="file" class="form-control noc-input-upload" id="txtAffidavitconsent" name="Affidavitconsent" onchange="return encodeImageFileAsURL(this,'PlaceDoc','PlaceDocExten')" />
                        <input type="hidden" id="PlaceDoc" />
                        <input type="hidden" id="PlaceDocExten" />
                    </div>
                    <div>
                        <label for="error" class="col-sm-12" id="errorFile" style="display:none;"></label>
                    </div>
                </div>
                <div class="col-lg-12 text-right">

                    <button class="theme-edit-btn" id="btnSave" style=""><i class="fas fa-plus"></i> Add</button>
                    <button class="theme-button-mockup" id="btnNext" style=" "><i class="fas fa-save"></i> Save & Next</button>
                    @*<a href="@Url.Action("EditApplication","Trustee")" class="btn btn-primary d-none" style="display: block;background-color: deeppink;" id="Reset">Back</a>*@
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <div class="noc-layouts-tbl">
                        <div class="form-group">
                            <table class="table table-borderless table-striped table-responsive-lg table-hover" id="tblIncome">
                                <thead class="dark">
                                    <tr>
                                        <th>Sr</th>

                                        <th>Course</th>
                                        <th>Facility</th>
                                        <th>File Document</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @if (FacilitesDetails != null)
                                    {
                                        int i = 1;
                                        foreach (var item in FacilitesDetails)
                                        {
                                            <tr>
                                                <td>@i</td>
                                                <td>@item.TagCourse</td>
                                                <td>@item.Facility</td>
                                                <td>
                                                    @if (item.File != null)
                                                    {
                                                        <div>

                                                            <a href="@Url.Action("DownloadFacilityDocuments", "Trustee", new { id = item.iPk_AddCourseId })" title="Facility File" target="_blank" alt="Red dot" class="noc-upload-btn" style="padding:5px 10px;"><i class="fas fa-download"></i></a>

                                                        </div>
                                                    }
                                                </td>
                                                <td class="d-flex" style="gap:2px;">
                                                    @*<a id="@item.iPk_AddCourseId" class="theme-edit-btn" title="Edit" onclick="EditCourse(@item.iPk_AddCourseId,'Get','NULL');"><i class="fas fa-edit"></i></a>*@
                                                    <a id="@item.iPk_AddCourseId" class="theme-delete-btn" title="Delete" onclick="DeleteCourseDetails(@item.iPk_AddCourseId,'Get','NULL');"><i class="far fa-trash-alt"></i></a>
                                                    @*<a id="@item.iFK_CourseId" class="Update" title="Subject" onclick="Subject(@item.iFK_CourseId,'Get','NULL');"><i class="fa-solid fa-book"></i></a>*@
                                                </td>
                                            </tr>
                                            i++;
                                        }
                                    }
                                    else
                                    {
                                        <tr>
                                            <td colspan="8" style="text-align: center;">No Data Available</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row col-lg-12" style="margin-top:20px">
                <div class="col-lg-12 loat-right">
                    @*<button class="theme-button-mockup" id="btnupload" style="float:right">Upload</button>*@
                    <button class="theme-button-mockup" id="btnSave" style="display:none;float:right">Save</button>
                    <a href="@Url.Action("EditApplication","Trustee")" class="btn btn-primary d-none" style="display: block; margin-right: 5px; background-color: deeppink;float:right" id="Reset">Back</a>

                </div>

            </div>
        </div>
    </div>
    @*}*@

    <!--<div class="row col-lg-12" style="margin-bottom:10px">
        <div class="col-lg-12 float-right">-->
    @*<div class="form-group col-lg-6" style="display: flex;align-items: end;">*@

    <!--<button class="btn" style="color: white !important; background: #00B4DB; /* fallback for old browsers */ background: -webkit-linear-gradient(to right, #0083B0, #00B4DB); /* Chrome 10-25, Safari 5.1-6 */ background: linear-gradient(to right, #0083B0, #00B4DB); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */; text-transform: uppercase; float:right;margin-left:10px"> Next<i class="fa fa-arrow-right"></i></button>
    <button class="btn" id="btnfinalSave" style="background: #bc4e9c; /* fallback for old browsers */ background: -webkit-linear-gradient(to right, #f80759, #bc4e9c); /* Chrome 10-25, Safari 5.1-6 */ background: linear-gradient(to right, #f80759, #bc4e9c); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */ color: white !important; text-transform: uppercase; float:right"><i class="fa fa-arrow-left"></i> Previous</button>-->
    @*</div>*@
    <!--</div>
    </div>-->
    @*<div class="row col-lg-12 float-right">
            <div class="form-group col-lg-12 float-right" style="display: flex;align-items: end;gap:10px;">

            </div>
        </div>*@
</div>
@section scripts {
    <script src="~/plugins/dropify/js/dropify.min.js"></script>
    <script src="~/scripts/pages/jquery.form-upload.init.js"></script>
    <script src="~/Content/globalDomain.js"></script>

}
<script type="text/javascript">
        //$('#chkAll').click(function () {
        //    $('.chk').prop('checked', this.checked)
        //});
    var imagebase64 = "";
    var imageMngbase64 = "";
    function encodeImageFileAsURL(element, hdnId, hdnExtnID) {
        var elementID = element.id;
        var file = element.files[0];
        console.log(file.name);
        //console.log(elementID);
        var reader = new FileReader();
        reader.onloadend = function () {
            imagebase64 = reader.result;
            $('#' + hdnId).val(imagebase64);
            var NameFile = $('#' + hdnExtnID).val(file.name);
            $('#' + hdnExtnID).val(file.name); //.replace(/[^a-z0-9\s]/gi, '').replace(/[_\s]/g, '-');
            console.log(imagebase64);
            console.log(hdnId);
            console.log("extension" + hdnExtnID);
        }
        reader.readAsDataURL(file);
        return imagebase64;
    }
    function encodeImageFileAsURLMang(element, hdnId, hdnExtnID) {
        var elementID = element.id;
        var file = element.files[0];
        console.log(file.name);
        //console.log(elementID);
        var reader = new FileReader();
        reader.onloadend = function () {
            imageMngbase64 = reader.result;
            $('#' + hdnId).val(imageMngbase64);
            var NameFile = $('#' + hdnExtnID).val(file.name);
            $('#' + hdnExtnID).val(file.name); //.replace(/[^a-z0-9\s]/gi, '').replace(/[_\s]/g, '-');
            console.log(imageMngbase64);
            console.log(hdnId);
            console.log("extension" + hdnExtnID);
        }
        reader.readAsDataURL(file);
        return imageMngbase64;
    }

     $(document).ready(function () {
      debugger
          if ('@FacilitesDetails.Count' > 0) {
              $("#btn_Facility").css({ "background": "rgb(13, 148, 13)", "color": "#fff" });
          }
          else {
              debugger
              $("#btn_Facility").css({ "background": "rgb(189, 0, 0)", "color": "#fff" });
          }
    });

    function GenerateArc(url) {

        $.ajax({
            url: GetglobalDomain() + url,
            type: 'GET',
            dataType: "text",
            success: function (response) {
                //$('#divFormContainer').html('');
                $('#divFormContainer1').removeAttr("style");
                $('#divFormContainer').html(response);
                $('#divLoader').css('display', 'none');
                return;
                /*  $("#AddSection").html(response);*/
            }
        });
        return false;
    }
    $(document).ready(function () {

        $("#btnNext").click(function () {

            $('#btn_Proof').click();
        });

            function CheckValid() {
                var status = true;
                debugger;
                console.log(status);
               debugger


                var option = $("#Course option:selected").html();

                if (option == "Select Course" || option == undefined) {
                   /* $('#Course').empty();*/
                    $('label[for="error"]').show();
                    errorCourse.textContent = "Please Select Course "
                    errorCourse.style.color = "red"
                    Course.style.border = "1px solid red"
                    $('#Course').focus();
                    $('#Course').val('');
                    status = false;
                }
                else {
                    $('#errorCourse').remove();
                    $("#Course").css({ 'border': '' });
                }

                debugger

                var Facil = $("#Facilites option:selected").html();
                if (Facil == "Select Facilites" || Facil == undefined) {
                    /* $('#Course').empty();*/
                    $('label[for="error"]').show();
                    errorFacilites.textContent = "Please Select Facilites "
                    errorFacilites.style.color = "red"
                    Facilites.style.border = "1px solid red"
                    $('#Facilites').focus();
                    $('#Facilites').val('');
                    status = false;
                }
                else {
                    $('#errorFacilites').remove();
                    $("#Facilites").css({ 'border': '' });
                }


                if (!$('#txtAffidavitconsent').val()) {
                    //TagDegree.style.border = "1px solid red";
                    $('label[for="error"]').show();
                    errorFile.textContent = "Please Select Chose File"
                    errorFile.style.color = "red"
                    txtAffidavitconsent.style.border = "1px solid red"
                    $('#txtAffidavitconsent').focus();
                    $('#txtAffidavitconsent').val('');
                    status = false;
                }
                else {
                    $('#errorTrustName').remove();
                    $("#txtAffidavitconsent").css({ 'border': '' });
                }




                return status;
            }
            $('#btnupload').click(function () {
                debugger
                var row_data = $('#tblFacility tbody tr').length;
                $("#tblFacility tbody TR").each(function () {
                    var row_data = $(this);
                    var Idget = row_data.find("td").eq(0).html().trim();
                    if ($('#up_' + Idget)[0].files.length > 0) {
                        var Idupload = $('#up_' + Idget)[0].files;
                        var reader = new FileReader();
                        reader.onload = function (e) {
                            binaryString = this.result;
                            $('#Upbase64_' + Idget).val(binaryString);
                        }
                        reader.readAsDataURL(Idupload[0]);
                    }
                });
                var Toast = Swal.mixin({
                        toast: true,
                        position: 'top-end',
                        showConfirmButton: false,
                        timer: 4000,
                        timerProgressBar: true,
                        onOpen: function (toast) {
                        toast.addEventListener('mouseenter', Swal.stopTimer)
                        toast.addEventListener('mouseleave', Swal.resumeTimer)
                        }
                })
                    Toast.fire({
                        icon: 'success' ,
                        title: 'Uploded Successfully!!'
                    })
                $('#btnupload').attr("style", "display:none");
                $('#btnSave').attr("style", "display:block");
                $('#btnSave').attr("style", "float:right");
            });
            $("#btnSave").click(function () {
                debugger
                var Cour = $("#Course").val();
                var Fact = $("#Facilites").val();
                var TrustId = $("#TrustId").val();
                var clgId = $("#clgId").val();
                var DeptId = $("#DeptId").val();
                var PlaceDoc = $('#PlaceDoc').val().split(',')[1];
                var PlaceDocExte = $('#PlaceDocExten').val().split('.')[1];
                var PlaceDocContent = $('#PlaceDoc').val().split(',')[0];
                if (PlaceDocContent != "") {
                    PlaceDocContent = $('#PlaceDoc').val().split(',')[0].split(':')[1].split(';')[0];
                }
                else {
                    PlaceDocContent = $('#PlaceDoc').val().split(',')[0];
                }
                var tableData = new Array();
                //var tableData = new Array();

                ////var trustId = $('#TrustId').val();
                ////var CollageId = $('#CollageId').val();
                ////var Guid = $('#Guid').val();
                //$("#tblFacility tbody TR").each(function () {
                //    var row_data = $(this);
                //    var Idget = row_data.find("td").eq(0).html().trim();
                //    var select = false;
                //    if ($('#select_' + Idget).is(":checked")) {
                //        select = true;
                //    }

                //    var getdata = { FacilityId: Idget, IsSelect: select, uploadFile: $('#Upbase64_' + Idget).val() }
                //    tableData.push(getdata);
                //});
                var getdata = { FacilityId: Fact, IsSelect: true, uploadFile: PlaceDoc, Extension: PlaceDocExte, ContentType: PlaceDocContent }
                tableData.push(getdata);
                var modal = {

                    TrustId: TrustId,
                    CollageId: clgId,
                    DeptId: DeptId,
                    CourseId: Cour,
                    list: tableData


                }
                if (CheckValid()) {
                    $.ajax({
                        type: "POST",
                        url: GetglobalDomain() + "/Trustee/CollageFacilitysAdd",
                        data: modal,
                        success: function (data) {
                            if (data.failure) {
                                debugger
                                //$('#btnSave').attr("style", "display:none");
                                //$('#btnupload').attr("style", "display:block");

                                Swal.fire({
                                    title: 'Data saved sussessfully!',
                                    showDenyButton: false,
                                    showCancelButton: false,
                                    confirmButtonText: 'Save',
                                    denyButtonText: `Don't save`,
                                }).then((result) => {
                                    /* Read more about isConfirmed, isDenied below */
                                    if (result.isConfirmed) {
                                        var url = "/Trustee/CollageFacilitys";
                                        GenerateArc(url);
                                        //window.location.href = url;
                                    }
                                })
                                //Swal.fire(
                                //    'Success',
                                //    'Success',
                                //    'Data Save Successfully!!'
                                //)
                                //var url = GetglobalDomain() + "/Trustee/CollageFacilitys";
                                //window.location.href = url;
                            }
                            else {
                                Swal.fire(
                                    'error',
                                    'Failed',
                                    'Data not Saved'
                                )
                                //$('#btnSave').attr("style", "display:none");
                                //$('#btnupload').attr("style", "display:block");
                            }
                        }
                    });
                }
            });
        });

    function DeleteCourseDetails(iPk_AddCourseId) {
        debugger
        var Model = {
            //type: itemType,
            id: parseInt(iPk_AddCourseId),
            //sub: SubjectName
        }
        var d = JSON.stringify(Model);
        console.log(d);
        Swal.fire({
            title: 'Are You Delete Confirmation ?',
            showDenyButton: true, showCancelButton: false,
            confirmButtonText: 'Yes',
            denyButtonText: 'No',
        }).then((result) => {
            if (result.isConfirmed) {

                $.ajax({
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    url: GetglobalDomain() + "/Trustee/DeleteFacility",
                    dataType: 'json',
                    type: 'Post',
                    cache: false,
                    data: JSON.stringify(Model),
                    success: function (data) {
                        debugger
                        console.log('ajax');
                        console.log(data);
                        if (data.StatusCode == 1) {

                          /*  $('#refer').load(' #refer')*/
                            Swal.fire({
                                position: 'center',
                                icon: 'success',
                                title: 'Delete Successfully',
                                showConfirmButton: false,
                                timer: 3000
                            })
                          debugger
                            var url = "/Trustee/CollageFacilitys";
                            setTimeout(function () {

                                GenerateArchtableNew(url);
                            }, 1000);
                        }
                    },
                    error: function (d) {
                        console.log(d);
                        alert("404. Please wait until the File is Loaded.");

                    }
                });
            }
            else if (result.isDenied) {
                Swal.fire('Cancel', '', 'info')
                $('#continue').css("display", "none");
                $('#btnCapitalAdd').css("display", "block");
            }
        });
    }

    function GenerateArchtableNew(url) {

        $.ajax({
            url: url,
            type: 'GET',
            dataType: "text",
            success: function (response) {
                //$('#divFormContainer').html('');
                $('#divFormContainer1').removeAttr("style");
                $('#divFormContainer').html(response);
                $('#divLoader').css('display', 'none');

                return;
                /*  $("#AddSection").html(response);*/
            }
        });

        return false;
    }

        @*function AddCollegeData(Type) {
            debugger
            var strHtml = "";
            strHtml += "<option value=''>Select College</option>";

            var Params = JSON.stringify(
                {
                    TrustInfoId: parseInt(Type),
                });

            $.ajax({
                url: GetglobalDomain() + "/Trustee/GetCollegeDropDownList",
                type: 'POST',
                data: Params,
                dataType: "json",
                contentType: "application/json",
                success: function (response) {

                    for (var i = 0; i < response.Data.length; i++) {
                        if (@ViewData["CollageId"].ToString() == response.Data[i].Id) {
                            strHtml += "<option value='" + response.Data[i].Id + "' selected>" + response.Data[i].text + "</option>"
                        }
                        else {
                            strHtml += "<option value='" + response.Data[i].Id + "'>" + response.Data[i].text + "</option>"
                        }
                    }
                    console.log("strHtml" + JSON.stringify("strHtml"));
                    $("#CollageId").html(strHtml);
                }
            });
        }*@
</script>